{# Template for the search page. #}
{% macro pagination() -%}
{% if results.total > per_page %}
<div class="pagination">
    {% set total_pages = (results.total / per_page)|round(0, 'ceil')|int %}

    {% if page > 1 %}
        <a href="{{ url_for('searchadv', q=query, t=types, c=countries, a=cats, page=page-1) }}">{{ _('Précédent') }}</a>
    {% endif %}

    {% for p in range(1, total_pages + 1) %}
        {% if p == page %}
            <span class="current">{{ p }}</span>
        {% else %}
            <a href="{{ url_for('searchadv', q=query, t=types, c=countries, a=cats, page=p) }}">{{ p }}</a>
        {% endif %}
    {% endfor %}

    {% if page < total_pages %}
        <a href="{{ url_for('searchadv', q=query, t=types, c=countries, a=cats, page=page+1) }}">{{ _('Suivant') }}</a>
    {% endif %}
</div>
{% endif %}
{% endmacro -%}
{%- extends "layout.html" %}
{% set title = _('Advanced search') %}
{% block extrahead %}
    <meta name="robots" content="noindex" />
    {{ super() }}
{% endblock %}
{% block body %}
  <h1 id="search-documentation">{{ _('Advanced search') }}</h1>
  {% block searchbox %}
  {% if error %}
  <div class="message error">{{ error }}</div>
  </br>
  {% endif %}
  {% if query_string %}
  <div class="message">{{ query_string }}</div>
  </br>
  {% endif %}
  <form action="" method="get">
    Type :
        {% for ftype in ftypes %}
            <label for="types_{{ ftype[0] }}">{{ ftype[0].capitalize() }}</label>
            <input type="checkbox" id="types_{{ ftype[0] }}" name="t" value="{{ ftype[0] }}"{% if ftype[1] == 1 %} checked{% endif %}/>
        {% endfor %}
    <br>
    Country :
        <select multiple id="country" name="c">
            {% for cc in fcountries %}
                <option value="{{ cc[0] }}" {% if cc[2] == 1 %} selected{% endif %}>{{ cc[1] }}</option>
            {% endfor %}
        </select>
    Cats :
        <select multiple id="cat" name="a">
            {% for ca in fcats %}
                <option value="{{ ca[0] }}" {% if ca[1] == 1 %} selected{% endif %}>{{ ca[0] }}</option>
            {% endfor %}
        </select>
    <br>
    <br>
    <input type="text" name="q" aria-labelledby="search-documentation" value="{{ query }}" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
    <input type="submit" value="{{ _('search') }}" />
    <input type="submit" name="reset" value="{{ _('Reset') }}" />
    <span id="search-progress" style="padding-left: 10px"></span>
  </form>
  {% endblock %}
  {% block searchresults %}
    {% if results is none %}
    {% elif results.total > 0 %}
        <p/>
        <p class="search-summary">Found <strong>{{ results.total }}</strong> items for <strong>{{ results.query_string }}</strong>.</p>
        <p/>
        {{ pagination() }}

        <div id="search-results">

                <ul role="list" class="search">

                    {% for result in results.results %}
                        <li class="kind-text">
                            <a href="{{ result.filepath }}" data-score="{{ result.score }}">{{ result.title|safe }}</a> <span class="score">{{ result.score|safe }}%</span>
                            <p class="description">
                                {{ result.description|safe }}<br/>
                            </p>
                            <p class="infos">
                                {% if result.begin is not none and result.begin != "" %} {{ result.begin|safe }} - {% endif %}{{ result.cats|safe }} - {{ result.country|safe }}
                            </p>
                            <p class="context">{{ result.context|safe }}</p>
                            {% for url in result.url %}
                                <a class="exturl" href="{{ url }}" target="_blank">{{ url }}</a>
                            {% endfor %}
                        </li>
                    {% endfor %}

                </ul>

        </div>

        {{ pagination() }}

    {% else %}
        <div class="no-results">
            <h2>{{ _('Aucun résultat trouvé') }}</h2>
            <p style="margin-top: 1rem; color: #5f6368;">
                {{ _('Votre recherche') }} "<strong>{{ results.query_string }}</strong>"
                {{ _('n\'a donné aucun résultat') }}.
            </p>
            <p style="margin-top: 1rem;">
                {{ _('Suggestions') }} :
            </p>
            <ul style="list-style: none; padding: 0; margin-top: 0.5rem; color: #5f6368;">
                <li>{{ _('Vérifiez l\'orthographe des mots-clés') }}</li>
                <li>{{ _('Essayez des mots-clés différents') }}</li>
                <li>{{ _('Essayez des mots-clés plus généraux') }}</li>
            </ul>
        </div>
    {% endif %}
  {% endblock %}
{% endblock %}
